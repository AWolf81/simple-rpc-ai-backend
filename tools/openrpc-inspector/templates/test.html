<style>
    .panels { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: 70vh; }
    .panel { display: flex; flex-direction: column; }
    .panel h3 { color: #f0f6fc; margin-bottom: 15px; border-bottom: 1px solid #30363d; padding-bottom: 10px; }
    textarea { 
        flex: 1;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; 
        background: #21262d; 
        color: #c9d1d9; 
        border: 1px solid #30363d; 
        padding: 15px; 
        font-size: 14px;
        resize: none;
        border-radius: 6px;
    }
    .controls { margin: 15px 0; }
    button { 
        background: #238636; 
        color: white; 
        border: none; 
        padding: 8px 16px; 
        cursor: pointer; 
        margin-right: 10px; 
        border-radius: 6px;
        font-family: inherit;
    }
    button:hover { background: #2ea043; }
    button.secondary { background: #21262d; border: 1px solid #30363d; }
    button.secondary:hover { background: #30363d; }
    .methods { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
    .method-btn { 
        background: #1f6feb; 
        padding: 4px 8px; 
        font-size: 12px; 
        border-radius: 4px;
    }
    .method-btn:hover { background: #388bfd; }
    .response { 
        flex: 1;
        background: #0d1117; 
        border: 1px solid #30363d; 
        padding: 15px; 
        white-space: pre-wrap; 
        overflow-y: auto;
        border-radius: 6px;
        font-size: 14px;
        color: #c9d1d9;
    }
    .test-status { margin-bottom: 10px; }
    .test-status.success { color: #3fb950; }
    .test-status.error { color: #f85149; }
    .test-status.pending { color: #d29922; }
    .content { background: #0d1117; color: #c9d1d9; }
</style>

<div class="panels">
    <div class="panel">
        <h3>üì§ Request</h3>
        
        <div class="methods">
            <div style="color: #7d8590; font-size: 12px;">Loading methods from OpenRPC schema...</div>
        </div>
        
        <textarea id="request" placeholder="Enter JSON-RPC request...">{
  "jsonrpc": "2.0",
  "method": "health",
  "params": [],
  "id": 1
}</textarea>
        
        <div class="controls">
            <button onclick="sendRequest()">üöÄ Send Request</button>
            <button class="secondary" onclick="formatRequest()">‚ú® Format JSON</button>
            <button class="secondary" onclick="clearAll()">üóëÔ∏è Clear All</button>
        </div>
    </div>
    
    <div class="panel">
        <h3>üì• Response</h3>
        <div class="test-status" id="status">Ready to send requests...</div>
        <div id="response" class="response">Click "Send Request" to test your RPC methods...</div>
    </div>
</div>

<script>
    let methodTemplates = {};
    
    // Load templates from OpenRPC schema
    async function loadTemplates() {
        try {
            const response = await fetch('/api/templates');
            if (response.ok) {
                methodTemplates = await response.json();
                updateMethodButtons();
            } else {
                console.error('Failed to load templates:', response.statusText);
            }
        } catch (error) {
            console.error('Error loading templates:', error);
        }
    }
    
    function updateMethodButtons() {
        const methodsContainer = document.querySelector('.methods');
        methodsContainer.innerHTML = '';
        
        Object.keys(methodTemplates).forEach(methodName => {
            const button = document.createElement('button');
            button.className = 'method-btn';
            button.textContent = methodName;
            button.onclick = () => setMethod(methodName);
            methodsContainer.appendChild(button);
        });
    }
    
    function setMethod(method) {
        const template = methodTemplates[method];
        if (template) {
            document.getElementById('request').value = JSON.stringify(template, null, 2);
        } else {
            // Fallback template
            const fallback = {
                jsonrpc: "2.0",
                method: method,
                params: {},
                id: Date.now()
            };
            document.getElementById('request').value = JSON.stringify(fallback, null, 2);
        }
    }
    
    // Load templates on page load
    loadTemplates();

    function formatRequest() {
        const requestText = document.getElementById('request').value;
        try {
            const parsed = JSON.parse(requestText);
            document.getElementById('request').value = JSON.stringify(parsed, null, 2);
        } catch (error) {
            setStatus('Invalid JSON format', 'error');
        }
    }

    function setStatus(message, type = 'pending') {
        const statusEl = document.getElementById('status');
        statusEl.textContent = message;
        statusEl.className = 'test-status ' + type;
    }

    async function sendRequest() {
        const requestText = document.getElementById('request').value;
        const responseDiv = document.getElementById('response');
        
        try {
            const request = JSON.parse(requestText);
            setStatus('Sending request...', 'pending');
            responseDiv.textContent = 'Waiting for response...';
            
            const startTime = Date.now();
            const response = await fetch('{{rpcUrl}}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: requestText
            });
            
            const duration = Date.now() - startTime;
            const result = await response.json();
            
            responseDiv.textContent = JSON.stringify(result, null, 2);
            
            if (response.ok && !result.error) {
                setStatus(`‚úÖ Success (${duration}ms)`, 'success');
            } else {
                setStatus(`‚ùå Error (${duration}ms)`, 'error');
            }
            
        } catch (error) {
            responseDiv.textContent = 'Error: ' + error.message;
            setStatus('‚ùå Request failed', 'error');
        }
    }
    
    function clearAll() {
        document.getElementById('response').textContent = 'Response cleared...';
        setStatus('Ready to send requests...');
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
            sendRequest();
        }
    });
</script>